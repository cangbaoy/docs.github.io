<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.14" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.52" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://www.sansei.top/exambook/Java-Service8.html"><meta property="og:site_name" content="川上富江"><meta property="og:title" content="怎么考虑数据一致性问题"><meta property="og:description" content="怎么考虑数据一致性问题 单体应用的数据一致性 想象一下如果我们经营着一家大型企业，下属有航空公司、租车公司、和连锁酒店。我们为客户提供一站式的旅游行程规划服务，这样客户只需要提供出行目的地，我们帮助客户预订机票、租车、以及预订酒店。从业务的角度，我们必须保证上述三个服务的预订都完成才能满足一个成功的旅游行程，否则不能成行。 我们的单体应用要满足这个需求..."><meta property="og:type" content="article"><meta property="og:image" content="http://114.116.184.67:81/images/service/service_66ecd4cb674eb4b55f786b7f8517ea07.png"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-08-30T14:18:24.000Z"><meta property="article:modified_time" content="2024-08-30T14:18:24.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"怎么考虑数据一致性问题","image":["http://114.116.184.67:81/images/service/service_66ecd4cb674eb4b55f786b7f8517ea07.png","http://114.116.184.67:81/images/service/service_f1a152a2a4a84d135fafb08525f0f9ce.png","http://114.116.184.67:81/images/service/service_fc69ade8b2ec344c0d6f53fbec302a37.png","http://114.116.184.67:81/images/service/service_66ae7b320e502c13f4a21a08baa61ead.png","http://114.116.184.67:81/images/service/service_918b4d0d912c6cdb8ee0690acf303950.png","http://114.116.184.67:81/images/service/service_c62a633865fd31b25688523cb5f4093f.png","http://114.116.184.67:81/images/service/service_b683af658000f43b34c7d99d6be060ca.png","http://114.116.184.67:81/images/service/service_44bd3121a8b6d720704e2d8b363ea2ce.png","http://114.116.184.67:81/images/service/service_b8624ace7c31f49016bde30abf444af0.png","http://114.116.184.67:81/images/service/service_f29111544bc473085109d3d04788be44.png","http://114.116.184.67:81/images/service/service_b09bbf2e8d332c163934ce165eab883e.png","http://114.116.184.67:81/images/service/service_1e14e4ad4804835734389a7a427ba9c3.png","http://114.116.184.67:81/images/service/service_a94dc9b0b1b2195f9cff27ea3056fd5d.png","http://114.116.184.67:81/images/service/service_204d8d1b2939d66cfb9752219ad70920.png","http://114.116.184.67:81/images/service/service_3f46ba9b45f867c33993cdb81871bfc9.png","http://114.116.184.67:81/images/service/service_1a7a9de881f2665697337a03fb1a5c6f.png"],"dateModified":"2024-08-30T14:18:24.000Z","author":[]}</script><title>怎么考虑数据一致性问题 | 川上富江</title><meta name="description" content="怎么考虑数据一致性问题 单体应用的数据一致性 想象一下如果我们经营着一家大型企业，下属有航空公司、租车公司、和连锁酒店。我们为客户提供一站式的旅游行程规划服务，这样客户只需要提供出行目的地，我们帮助客户预订机票、租车、以及预订酒店。从业务的角度，我们必须保证上述三个服务的预订都完成才能满足一个成功的旅游行程，否则不能成行。 我们的单体应用要满足这个需求...">
    <link rel="stylesheet" href="/assets/css/styles.ed1ea483.css">
    <link rel="preload" href="/assets/js/runtime~app.e84162b8.js" as="script"><link rel="preload" href="/assets/css/styles.ed1ea483.css" as="style"><link rel="preload" href="/assets/js/4893.6b2ef6da.js" as="script"><link rel="preload" href="/assets/js/app.bb7342ad.js" as="script">
    <link rel="prefetch" href="/assets/js/exambook_Java-Design-Model1.html.3df83142.js" as="script"><link rel="prefetch" href="/assets/js/devops_markdown_index.html.d516dc45.js" as="script"><link rel="prefetch" href="/assets/js/1810.2e25d71c.js" as="script"><link rel="prefetch" href="/assets/js/devops_basic_linux_中间件搭建.html.4d9e8884.js" as="script"><link rel="prefetch" href="/assets/js/devops_basic_linux_虚拟机系统的配置.html.75127182.js" as="script"><link rel="prefetch" href="/assets/js/photo-swipe.e3ee2e95.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Design-Model6.html.fa031aa3.js" as="script"><link rel="prefetch" href="/assets/js/devops_basic_windows_IDEA安装与配置.html.929fc2cc.js" as="script"><link rel="prefetch" href="/assets/js/devops_basic_windows_GIT命令使用手册.html.a615416f.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Service9.html.67c22483.js" as="script"><link rel="prefetch" href="/assets/js/devops_basic_linux_私服搭建.html.03e4d180.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Service5.html.2bfef1e7.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Service8.html.8e532654.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Service12.html.d8dd295e.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Distributed3.html.9509ce25.js" as="script"><link rel="prefetch" href="/assets/js/devops_basic_linux_Linux单独节点配置.html.18b18ce4.js" as="script"><link rel="prefetch" href="/assets/js/giscus.6f22895a.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Performance3.html.7d069243.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-AnalNeed5.html.2917f17f.js" as="script"><link rel="prefetch" href="/assets/js/guide_markdown.html.a4d8c879.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Design-Ability3.html.db9fa16b.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Distributed4.html.a7395e87.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-AnalNeed4.html.41c0ca90.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Design-Ability5.html.e2b5b2c7.js" as="script"><link rel="prefetch" href="/assets/js/devops_basic_windows_Fiddler安装及使用.html.f3e14d5b.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-AnalNeed1.html.0fabcffe.js" as="script"><link rel="prefetch" href="/assets/js/devops_basic_linux_搭建SonarQube代码质量检测平台.html.f1521acd.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Mysql6.html.32632f33.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Security5.html.9cb8cc54.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Service6.html.43e33817.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Distributed5.html.bdd19d22.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Security2.html.3f12b627.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Security7.html.9817374d.js" as="script"><link rel="prefetch" href="/assets/css/3616.styles.a6782cab.css" as="style"><link rel="prefetch" href="/assets/js/exambook_Java-Design-Ability4.html.9397ad4a.js" as="script"><link rel="prefetch" href="/assets/js/devops_markdown_emoji_object.html.e2d6504d.js" as="script"><link rel="prefetch" href="/assets/js/exambook_knowledge1.html.d7995dd0.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Security4.html.79a44dd4.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Redis3.html.ec992d51.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Design-Ability1.html.d2fb9ede.js" as="script"><link rel="prefetch" href="/assets/js/devops_basic_linux_install-docker-compose.html.39357c95.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Mysql1.html.a06fb0d7.js" as="script"><link rel="prefetch" href="/assets/js/devops_markdown_emoji_symbol.html.708c48aa.js" as="script"><link rel="prefetch" href="/assets/js/exambook_knowledge4.html.cf7e66a2.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Design-Model2.html.678f5519.js" as="script"><link rel="prefetch" href="/assets/js/knowledge_springcloud_spring-cloud-netflix.html.631a31a5.js" as="script"><link rel="prefetch" href="/assets/js/devops_basic_linux_install-ubuntu-server.html.39a9e868.js" as="script"><link rel="prefetch" href="/assets/js/devops_markdown_emoji_people.html.2eaa0620.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Service11.html.3703e0e5.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Security6.html.6786a5f3.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Service7.html.1d219946.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Design-Model3.html.4fb09524.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-MQ3.html.a4db8b15.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Design-Model4.html.7f29e9e9.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Performance2.html.b511fb5c.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Mysql12.html.d8ddfafe.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Service3.html.d7353778.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Security3.html.7914d219.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Performance1.html.8fbf5ac2.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Design-Model5.html.cfc95b6c.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Mysql4.html.a46a6a21.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Mysql2.html.53532c00.js" as="script"><link rel="prefetch" href="/assets/js/guide_page.html.cb04f9ae.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Redis8.html.6a29ce23.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Mysql5.html.84e0da79.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Security1.html.3a0df42d.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Thread1.html.b35d0c25.js" as="script"><link rel="prefetch" href="/assets/js/devops_markdown_emoji_nature.html.daa3bff3.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Thread2.html.9055e22a.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Service13.html.ba87c339.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Service1.html.08a3d33d.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Distributed2.html.e520b403.js" as="script"><link rel="prefetch" href="/assets/js/devops_markdown_emoji_place.html.7508abca.js" as="script"><link rel="prefetch" href="/assets/js/exambook_javabasics10.html.c4095133.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Design-Ability2.html.bceccb93.js" as="script"><link rel="prefetch" href="/assets/js/exambook_knowledge5.html.59bdfb14.js" as="script"><link rel="prefetch" href="/assets/js/knowledge_springboot_index.html.9f15fdcf.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Spring6.html.d722009d.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Distributed1.html.1d4b640d.js" as="script"><link rel="prefetch" href="/assets/js/devops_basic_windows_Chrome插件安装时程序包无效.html.d6292e4d.js" as="script"><link rel="prefetch" href="/assets/js/exambook_knowledge2.html.caea6252.js" as="script"><link rel="prefetch" href="/assets/js/knowledge_springboot_SpringBoot-整合Thymeleaf.html.8c519592.js" as="script"><link rel="prefetch" href="/assets/js/knowledge_springcloud_apache-dubbo.html.28b0f965.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-AnalNeed2.html.2e9ac0ff.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Spring4.html.6ab6e0d1.js" as="script"><link rel="prefetch" href="/assets/js/guide_index.html.1dcc9966.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Locking4.html.a5b497d3.js" as="script"><link rel="prefetch" href="/assets/js/devops_basic_linux_index.html.6fe87212.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Service4.html.c34e4253.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Mysql3.html.121c807f.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Other-Case.html.22c13c5c.js" as="script"><link rel="prefetch" href="/assets/js/exambook_javabasics1.html.ab7655ab.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Thread10.html.04385f6a.js" as="script"><link rel="prefetch" href="/assets/js/knowledge_springcloud_spring-cloud-alibaba.html.850d8c20.js" as="script"><link rel="prefetch" href="/assets/js/exambook_javabasics4.html.fd399632.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Service10.html.16bef930.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-List3.html.9be87358.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Mysql13.html.e2696e97.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Mysql10.html.b5a95a0a.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Service14.html.257eb14a.js" as="script"><link rel="prefetch" href="/assets/js/exambook_javabasics6.html.62357e3d.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Mysql9.html.00e3cf3e.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-MQ4.html.f1e0a8a6.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-List5.html.6d0ad767.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Design-Ability6.html.2421daeb.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Service2.html.c115dade.js" as="script"><link rel="prefetch" href="/assets/js/exambook_javabasics7.html.0612c9f4.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Locking7.html.d9ebbdc6.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Mysql8.html.287b7c2b.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Locking5.html.3843c0ee.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Locking6.html.8a0b1c39.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Mysql7.html.87d7af1a.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Thread9.html.d61c9b68.js" as="script"><link rel="prefetch" href="/assets/js/exambook_javabasics8.html.780d723b.js" as="script"><link rel="prefetch" href="/assets/js/exambook_javabasics5.html.d9c31b9c.js" as="script"><link rel="prefetch" href="/assets/js/knowledge_vue_Vue前端框架体系.html.338692f5.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Spring1.html.0098adc2.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Redis5.html.fe60faf4.js" as="script"><link rel="prefetch" href="/assets/js/exambook_javabasics2.html.79ae31ca.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Netty5.html.1b73d03c.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Netty1.html.7f57b8c9.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Redis2.html.5ce9abd5.js" as="script"><link rel="prefetch" href="/assets/js/knowledge_vue_index.html.9bc99006.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Netty8.html.d45a4f0f.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Spring2.html.0db744f8.js" as="script"><link rel="prefetch" href="/assets/js/exambook_javabasics12.html.04379f57.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Mysql14.html.158ab275.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Spring5.html.30a21464.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Spring11.html.3bfbe0aa.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Spring3.html.c908e05c.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Mysql15.html.78bc69ac.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Netty2.html.6ed6ccc1.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Redis6.html.c62e9826.js" as="script"><link rel="prefetch" href="/assets/js/exambook_javabasics3.html.97c0a599.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-MQ2.html.f6f5148b.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-MQ5.html.3f99d1c6.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Locking1.html.59bef526.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-List2.html.c3eaa799.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Locking2.html.389de533.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-List7.html.936e72a2.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Thread6.html.f4acd247.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Netty4.html.2ed4e02e.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Spring7.html.1f9e1338.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-List8.html.025dd8d6.js" as="script"><link rel="prefetch" href="/assets/js/guide_encrypt.html.46f0f44a.js" as="script"><link rel="prefetch" href="/assets/js/exambook_javabasics9.html.47705282.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-List4.html.15e03ec0.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Netty6.html.836b204a.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Spring8.html.2563329e.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-List1.html.f1472667.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Thread3.html.30b34dd4.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-MQ1.html.6ff5c103.js" as="script"><link rel="prefetch" href="/assets/js/exambook_javabasics13.html.22434f6f.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Netty3.html.0ca0b4f5.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Thread5.html.d697b9bd.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-List9.html.6f4d3628.js" as="script"><link rel="prefetch" href="/assets/js/guide_disable.html.712e0b82.js" as="script"><link rel="prefetch" href="/assets/js/knowledge_springcloud_spring-security-oauth2.html.c092920f.js" as="script"><link rel="prefetch" href="/assets/js/exambook_javabasics11.html.8ae02960.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Thread7.html.4fa9a78f.js" as="script"><link rel="prefetch" href="/assets/js/index.html.f6e7c2e9.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-MQ6.html.e2dbde0c.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Spring9.html.c6be12a5.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Netty7.html.3795e106.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-AnalNeed3.html.6ebbe346.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Thread8.html.5c4a75f0.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Thread4.html.7a23c18c.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Redis7.html.835f6da6.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-List6.html.e628530a.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Locking3.html.40bc99ee.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Mysql11.html.bab84543.js" as="script"><link rel="prefetch" href="/assets/js/exambook_knowledge3.html.bd7d2a4e.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Redis9.html.10048614.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Spring10.html.e94515c0.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Redis4.html.76710f0a.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Redis1.html.c7231319.js" as="script"><link rel="prefetch" href="/assets/js/exambook_index.html.5c1556e6.js" as="script"><link rel="prefetch" href="/assets/js/exambook_补充知识点.html.5564ba4b.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Thread11.html.71e34978.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Netty9.html.b7263af3.js" as="script"><link rel="prefetch" href="/assets/js/knowledge_springboot_SpringBoot-钉钉机器人通知群功能.html.9ef8a25e.js" as="script"><link rel="prefetch" href="/assets/js/notebook_index.html.c516c039.js" as="script"><link rel="prefetch" href="/assets/js/knowledge_index.html.646da692.js" as="script"><link rel="prefetch" href="/assets/js/knowledge_springboot_SpringBoot-整合MyBatis.html.af177e7f.js" as="script"><link rel="prefetch" href="/assets/js/knowledge_springboot_SpringBoot-整合Quartz.html.1d458ce0.js" as="script"><link rel="prefetch" href="/assets/js/devops_basic_index.html.07756c82.js" as="script"><link rel="prefetch" href="/assets/js/knowledge_servicemesh_index.html.9bf6e1ba.js" as="script"><link rel="prefetch" href="/assets/js/knowledge_openplatform_index.html.54ebf4d4.js" as="script"><link rel="prefetch" href="/assets/js/knowledge_springcloud_index.html.2e1174c8.js" as="script"><link rel="prefetch" href="/assets/js/knowledge_ai_index.html.92338a5b.js" as="script"><link rel="prefetch" href="/assets/js/devops_basic_windows_index.html.06fd7504.js" as="script"><link rel="prefetch" href="/assets/js/devops_markdown_emoji_index.html.11c81856.js" as="script"><link rel="prefetch" href="/assets/js/devops_index.html.1e3a208f.js" as="script"><link rel="prefetch" href="/assets/js/404.html.c1161908.js" as="script"><link rel="prefetch" href="/assets/css/1058.styles.3ca50afa.css" as="style"><link rel="prefetch" href="/assets/js/7402.b22a97a9.js" as="script"><link rel="prefetch" href="/assets/js/8264.f052fd25.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">川上富江</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="主页"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span><!--]-->主页<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/guide/" aria-label="指南"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span><!--]-->指南<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/knowledge/" aria-label="知识库"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-splotch" style=""></span><!--]-->知识库<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/notebook/" aria-label="笔记系列"><!--[--><span class="font-icon icon fa-fw fa-sm fa-solid fa-book-open" style=""></span><!--]-->笔记系列<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link route-link-active auto-link" href="/exambook/" aria-label="面试宝典"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-circle-question" style=""></span><!--]-->面试宝典<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="运维相关"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-circle-info" style=""></span>运维相关<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">基础设施</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/devops/basic/windows/" aria-label="Windows 系列"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-gear" style=""></span><!--]-->Windows 系列<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/devops/basic/linux/" aria-label="Linux 系列"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-gear" style=""></span><!--]-->Linux 系列<!----></a></li></ul></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">高级</h4><ul class="vp-dropdown-subitems"></ul></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/cangbaoy/docs.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索文档"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索文档</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/" aria-label="面试宝典"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-circle-question" style=""></span><!--]-->面试宝典<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Design-Model3.html" aria-label="23 种设计模式的设计理念"><!---->23 种设计模式的设计理念<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Mysql1.html" aria-label="58 到家 MySQL 军规升级版"><!---->58 到家 MySQL 军规升级版<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Locking6.html" aria-label="ABA 问题"><!---->ABA 问题<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-List3.html" aria-label="ArrayList 与 LinkedList 区别"><!---->ArrayList 与 LinkedList 区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-List4.html" aria-label="ArrayList 与 Vector 区别"><!---->ArrayList 与 Vector 区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Spring1.html" aria-label="BeanFactory 和 ApplicationContext 有什么区别"><!---->BeanFactory 和 ApplicationContext 有什么区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Service7.html" aria-label="CAP 定理、 BASE 理论"><!---->CAP 定理、 BASE 理论<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Locking5.html" aria-label="CAS 乐观锁"><!---->CAS 乐观锁<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-List9.html" aria-label="ConcurrentHashMap 的工作原理及代码实现"><!---->ConcurrentHashMap 的工作原理及代码实现<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Mysql15.html" aria-label="ElasticSearch 使用场景"><!---->ElasticSearch 使用场景<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/javabasics13.html" aria-label="equals 与 == 的区别"><!---->equals 与 == 的区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/javabasics2.html" aria-label="final, finally, finalize 的区别"><!---->final, finally, finalize 的区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-List7.html" aria-label="HashMap 和 ConcurrentHashMap 的区别"><!---->HashMap 和 ConcurrentHashMap 的区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-List5.html" aria-label="HashMap 和 HashTable 的区别"><!---->HashMap 和 HashTable 的区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-List8.html" aria-label="HashMap 的工作原理及代码实现"><!---->HashMap 的工作原理及代码实现<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-List6.html" aria-label="HashSet 和 HashMap 区别"><!---->HashSet 和 HashMap 区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/javabasics8.html" aria-label="HTTP 请求的 GET 与 POST 方式的区别"><!---->HTTP 请求的 GET 与 POST 方式的区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Security4.html" aria-label="HTTPS 原理剖析"><!---->HTTPS 原理剖析<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Security5.html" aria-label="HTTPS 降级攻击"><!---->HTTPS 降级攻击<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/javabasics3.html" aria-label="int 和 Integer 有什么区别"><!---->int 和 Integer 有什么区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/javabasics11.html" aria-label="JDBC 流程"><!---->JDBC 流程<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Mysql10.html" aria-label="limit 20000 加载很慢怎么解决"><!---->limit 20000 加载很慢怎么解决<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-List2.html" aria-label="List 和 Map 区别"><!---->List 和 Map 区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-List1.html" aria-label="List 和 Set 区别"><!---->List 和 Set 区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Mysql13.html" aria-label="MongoDB 使用场景"><!---->MongoDB 使用场景<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/javabasics12.html" aria-label="MVC 设计思想"><!---->MVC 设计思想<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/knowledge4.html" aria-label="MySQL 优化"><!---->MySQL 优化<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Mysql7.html" aria-label="MySQL 遇到的死锁问题"><!---->MySQL 遇到的死锁问题<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Netty8.html" aria-label="Netty 内部执行流程"><!---->Netty 内部执行流程<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Netty6.html" aria-label="Netty 线程模型"><!---->Netty 线程模型<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Netty9.html" aria-label="Netty 重连实现"><!---->Netty 重连实现<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Redis7.html" aria-label="Redis 为什么是单线程的"><!---->Redis 为什么是单线程的<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Redis4.html" aria-label="Redis 使用场景"><!---->Redis 使用场景<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Redis3.html" aria-label="Redis 内存淘汰机制"><!---->Redis 内存淘汰机制<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Redis2.html" aria-label="Redis 内部结构"><!---->Redis 内部结构<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Redis5.html" aria-label="Redis 持久化机制"><!---->Redis 持久化机制<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Redis1.html" aria-label="Redis 有哪些类型"><!---->Redis 有哪些类型<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Redis6.html" aria-label="Redis 集群方案与实现"><!---->Redis 集群方案与实现<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/javabasics9.html" aria-label="session 与 cookie 区别"><!---->session 与 cookie 区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/javabasics10.html" aria-label="session 分布式处理"><!---->session 分布式处理<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Distributed2.html" aria-label="Session 分布式方案"><!---->Session 分布式方案<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Thread2.html" aria-label="sleep()、join（）、yield（）有什么区别"><!---->sleep()、join（）、yield（）有什么区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Spring2.html" aria-label="Spring Bean 的生命周期"><!---->Spring Bean 的生命周期<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Spring3.html" aria-label="Spring IOC 如何实现"><!---->Spring IOC 如何实现<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Spring9.html" aria-label="Spring MVC 启动流程"><!---->Spring MVC 启动流程<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Spring8.html" aria-label="Spring MVC 运行流程"><!---->Spring MVC 运行流程<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Spring5.html" aria-label="Spring 事务实现方式"><!---->Spring 事务实现方式<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Spring6.html" aria-label="Spring 事务底层原理"><!---->Spring 事务底层原理<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Spring11.html" aria-label="Spring 框架中用到了哪些设计模式"><!---->Spring 框架中用到了哪些设计模式<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Spring10.html" aria-label="Spring 的单例实现原理"><!---->Spring 的单例实现原理<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Mysql6.html" aria-label="SQL 优化之道"><!---->SQL 优化之道<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Locking3.html" aria-label="synchronize 实现原理"><!---->synchronize 实现原理<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Locking4.html" aria-label="synchronized 与 lock 的区别"><!---->synchronized 与 lock 的区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Netty5.html" aria-label="TCP 粘包/拆包的解决办法"><!---->TCP 粘包/拆包的解决办法<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Thread8.html" aria-label="ThreadLocal 原理分析"><!---->ThreadLocal 原理分析<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Locking2.html" aria-label="volatile 实现原理"><!---->volatile 实现原理<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/knowledge3.html" aria-label="Zookeeper 假死脑裂"><!---->Zookeeper 假死脑裂<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Netty1.html" aria-label="为什么选择 Netty"><!---->为什么选择 Netty<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Locking7.html" aria-label="乐观锁的业务场景及实现方式"><!---->乐观锁的业务场景及实现方式<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Service4.html" aria-label="什么是 RESTful"><!---->什么是 RESTful<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Service3.html" aria-label="什么是 RPC 框架"><!---->什么是 RPC 框架<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Netty4.html" aria-label="什么是 TCP 粘包/拆包"><!---->什么是 TCP 粘包/拆包<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Spring4.html" aria-label="什么是Spring AOP"><!---->什么是Spring AOP<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Mysql3.html" aria-label="什么是反模式设计"><!---->什么是反模式设计<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Design-Ability5.html" aria-label="你如何划分领域边界"><!---->你如何划分领域边界<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-AnalNeed1.html" aria-label="你如何对需求原型进行理解和拆分"><!---->你如何对需求原型进行理解和拆分<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-AnalNeed5.html" aria-label="你如何理解用户痛点"><!---->你如何理解用户痛点<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Design-Ability3.html" aria-label="你如何考虑服务化"><!---->你如何考虑服务化<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Design-Ability2.html" aria-label="你如何考虑组件化"><!---->你如何考虑组件化<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Design-Ability4.html" aria-label="你如何进行领域建模"><!---->你如何进行领域建模<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-AnalNeed4.html" aria-label="你针对产品提出哪些交互和改进意见"><!---->你针对产品提出哪些交互和改进意见<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Redis9.html" aria-label="使用缓存的合理性问题"><!---->使用缓存的合理性问题<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Mysql14.html" aria-label="倒排索引"><!---->倒排索引<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Service9.html" aria-label="最终一致性的实现方案"><!---->最终一致性的实现方案<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Distributed4.html" aria-label="分布式事务"><!---->分布式事务<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Distributed3.html" aria-label="分布式锁的场景与实现"><!---->分布式锁的场景与实现<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Mysql5.html" aria-label="分库与分表带来的分布式困境与应对之策"><!---->分库与分表带来的分布式困境与应对之策<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Mysql4.html" aria-label="分库与分表设计"><!---->分库与分表设计<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Thread1.html" aria-label="创建线程的方式及实现"><!---->创建线程的方式及实现<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Service1.html" aria-label="前后端分离是如何做的"><!---->前后端分离是如何做的<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Netty3.html" aria-label="原生的 NIO 在 JDK 1.7 版本存在 EPoll BUG"><!---->原生的 NIO 在 JDK 1.7 版本存在 EPoll BUG<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/knowledge1.html" aria-label="双亲委派模型"><!---->双亲委派模型<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Security7.html" aria-label="基于角色的访问控制"><!---->基于角色的访问控制<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-MQ6.html" aria-label="如何保证消息的有序性"><!---->如何保证消息的有序性<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Performance2.html" aria-label="如何发现性能瓶颈"><!---->如何发现性能瓶颈<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Service13.html" aria-label="如何应对微服务的链式调用异常"><!---->如何应对微服务的链式调用异常<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Service11.html" aria-label="如何拆分服务"><!---->如何拆分服务<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Service6.html" aria-label="如何理解 RESTful API 的幂等性"><!---->如何理解 RESTful API 的幂等性<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Spring7.html" aria-label="如何自定义注解实现功能"><!---->如何自定义注解实现功能<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Service5.html" aria-label="如何设计一个良好的 API"><!---->如何设计一个良好的 API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Mysql8.html" aria-label="存储引擎的 InnoDB 与 MyiSAM"><!---->存储引擎的 InnoDB 与 MyiSAM<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Security1.html" aria-label="安全要素与 STRIDE 威胁"><!---->安全要素与 STRIDE 威胁<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Service10.html" aria-label="微服务与 SOA 的区别"><!---->微服务与 SOA 的区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Service2.html" aria-label="微服务哪些框架"><!---->微服务哪些框架<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Service12.html" aria-label="微服务如何进行数据库管理"><!---->微服务如何进行数据库管理<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Service14.html" aria-label="微服务的安全"><!---->微服务的安全<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/exambook/Java-Service8.html" aria-label="怎么考虑数据一致性问题"><!---->怎么考虑数据一致性问题<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Performance1.html" aria-label="性能指标有哪些"><!---->性能指标有哪些<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Performance3.html" aria-label="性能调优的常见手段"><!---->性能调优的常见手段<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/javabasics5.html" aria-label="抽象类和接口有什么区别"><!---->抽象类和接口有什么区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Security6.html" aria-label="授权与认证"><!---->授权与认证<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/knowledge5.html" aria-label="数据库的分库分表"><!---->数据库的分库分表<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Mysql2.html" aria-label="数据库索引的原理与使用事项"><!---->数据库索引的原理与使用事项<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Security3.html" aria-label="服务端通信安全攻防"><!---->服务端通信安全攻防<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Other-Case.html" aria-label="概述"><!---->概述<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/knowledge2.html" aria-label="死信、延迟、重试队列"><!---->死信、延迟、重试队列<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-MQ4.html" aria-label="消息的堆积解决思路"><!---->消息的堆积解决思路<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-MQ3.html" aria-label="消息的幂等性解决思路"><!---->消息的幂等性解决思路<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-MQ2.html" aria-label="消息的重发补偿解决思路"><!---->消息的重发补偿解决思路<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-MQ1.html" aria-label="消息队列的使用场景"><!---->消息队列的使用场景<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Locking1.html" aria-label="线程安全问题"><!---->线程安全问题<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Thread10.html" aria-label="线程池的几种方式与使用场景"><!---->线程池的几种方式与使用场景<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Thread11.html" aria-label="线程的生命周期"><!---->线程的生命周期<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Redis8.html" aria-label="缓存崩溃 与 缓存降级"><!---->缓存崩溃 与 缓存降级<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Mysql9.html" aria-label="聚集索引与非聚集索引的区别"><!---->聚集索引与非聚集索引的区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-MQ5.html" aria-label="自己如何实现消息队列"><!---->自己如何实现消息队列<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/%E8%A1%A5%E5%85%85%E7%9F%A5%E8%AF%86%E7%82%B9.html" aria-label="补充知识点"><!---->补充知识点<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Thread9.html" aria-label="讲讲线程池的实现原理"><!---->讲讲线程池的实现原理<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Design-Model4.html" aria-label="设计模式之间的异同，例如策略模式与状态模式的区别"><!---->设计模式之间的异同，例如策略模式与状态模式的区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Design-Model5.html" aria-label="设计模式之间的结合，例如策略模式 + 简单工厂模式的实践"><!---->设计模式之间的结合，例如策略模式 + 简单工厂模式的实践<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Design-Model6.html" aria-label="设计模式的性能，例如单例模式哪种性能更好"><!---->设计模式的性能，例如单例模式哪种性能更好<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Thread7.html" aria-label="说说 CountDownLatch 与 CyclicBarrier 区别"><!---->说说 CountDownLatch 与 CyclicBarrier 区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Thread3.html" aria-label="说说 CountDownLatch 原理"><!---->说说 CountDownLatch 原理<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Thread4.html" aria-label="说说 CyclicBarrier 原理"><!---->说说 CyclicBarrier 原理<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Thread6.html" aria-label="说说 Exchanger 原理"><!---->说说 Exchanger 原理<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Netty7.html" aria-label="说说 Netty 的零拷贝"><!---->说说 Netty 的零拷贝<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Thread5.html" aria-label="说说 Semaphore 原理"><!---->说说 Semaphore 原理<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Netty2.html" aria-label="说说业务中 Netty 的使用场景"><!---->说说业务中 Netty 的使用场景<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Design-Ability1.html" aria-label="说说你在项目中使用过的 UML 图"><!---->说说你在项目中使用过的 UML 图<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-AnalNeed2.html" aria-label="说说你对功能性需求的理解"><!---->说说你对功能性需求的理解<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Design-Model2.html" aria-label="说说你对设计原则的理解"><!---->说说你对设计原则的理解<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-AnalNeed3.html" aria-label="说说你对非功能性需求的理解"><!---->说说你对非功能性需求的理解<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/javabasics6.html" aria-label="说说反射的用途及实现"><!---->说说反射的用途及实现<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Design-Model1.html" aria-label="说说常用开源框架中设计模式使用分析"><!---->说说常用开源框架中设计模式使用分析<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Design-Ability6.html" aria-label="说说概要设计"><!---->说说概要设计<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/javabasics7.html" aria-label="说说自定义注解的场景及实现"><!---->说说自定义注解的场景及实现<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Distributed1.html" aria-label="谈谈业务中使用分布式的场景"><!---->谈谈业务中使用分布式的场景<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Mysql11.html" aria-label="选择合适的分布式主键方案"><!---->选择合适的分布式主键方案<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Mysql12.html" aria-label="选择合适的数据存储方案"><!---->选择合适的数据存储方案<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/javabasics4.html" aria-label="重载和重写的区别"><!---->重载和重写的区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Security2.html" aria-label="防范常见的 Web 攻击"><!---->防范常见的 Web 攻击<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Distributed5.html" aria-label="集群与负载均衡的算法与实现"><!---->集群与负载均衡的算法与实现<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/javabasics1.html" aria-label="面向对象的特征"><!---->面向对象的特征<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->怎么考虑数据一致性问题</h1><div class="page-info"><!----><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-08-30T14:18:24.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 16 分钟</span><meta property="timeRequired" content="PT16M"></span><!----><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#单体应用的数据一致性">单体应用的数据一致性</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#微服务场景下的数据一致性">微服务场景下的数据一致性</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#sagas">Sagas</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#saga-的运行原理">Saga 的运行原理</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#saga-的恢复方式">Saga 的恢复方式</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#使用-saga-的条件">使用 Saga 的条件</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#saga-log">Saga Log</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#saga-请求的数据结构">Saga 请求的数据结构</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#parallel-saga">Parallel Saga</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#acid-and-saga">ACID and Saga</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#saga-架构">Saga 架构</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#两阶段提交-two-phase-commit-2pc">两阶段提交 Two-Phase Commit (2PC)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#try-confirm-cancel-tcc">Try-Confirm/Cancel (TCC)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#事件驱动的架构">事件驱动的架构</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#集中式与非集中式实现">集中式与非集中式实现</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#总结">总结</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="怎么考虑数据一致性问题" tabindex="-1"><a class="header-anchor" href="#怎么考虑数据一致性问题"><span>怎么考虑数据一致性问题</span></a></h1><h2 id="单体应用的数据一致性" tabindex="-1"><a class="header-anchor" href="#单体应用的数据一致性"><span>单体应用的数据一致性</span></a></h2><p>想象一下如果我们经营着一家大型企业，下属有航空公司、租车公司、和连锁酒店。我们为客户提供一站式的旅游行程规划服务，这样客户只需要提供出行目的地，我们帮助客户预订机票、租车、以及预订酒店。从业务的角度，我们必须保证上述三个服务的预订都完成才能满足一个成功的旅游行程，否则不能成行。</p><p>我们的单体应用要满足这个需求非常简单，只需将这个三个服务请求放到同一个数据库事务中，数据库会帮我们保证全部成功或者全部回滚。</p><figure><img src="http://114.116.184.67:81/images/service/service_66ecd4cb674eb4b55f786b7f8517ea07.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>当这个功能上线以后，公司非常满意，客户也非常高兴。</p><h2 id="微服务场景下的数据一致性" tabindex="-1"><a class="header-anchor" href="#微服务场景下的数据一致性"><span>微服务场景下的数据一致性</span></a></h2><p>这几年中，我们的行程规划服务非常成功，企业蒸蒸日上，用户量也翻了数十倍。企业的下属航空公司、租车公司、和连锁酒店也相继推出了更多服务以满足客户需求，我们的应用和开发团队也因此日渐庞大。如今我们的单体应用已变得如此复杂，以至于没人了解整个应用是怎么运作的。更糟的是新功能的上线现在需要所有研发团队合作，日夜奋战数周才能完成。看着市场占有率每况愈下，公司高层对研发部门越来越不满意。</p><p>经过数轮讨论，我们最终决定将庞大的单体应用一分为四：机票预订服务、租车服务、酒店预订服务、和支付服务。服务各自使用自己的数据库，并通过 HTTP 协议通信。负责各服务的团队根据市场需求按照自己的开发节奏发版上线。如今我们面临新的挑战：如何保证最初三个服务的预订都完成才能满足一个成功的旅游行程， 否则不能成行的业务规则？现在服务有各自的边界，而且数据库选型也不尽相同，通过数据库保证数据一致性的方案已不可行。</p><figure><img src="http://114.116.184.67:81/images/service/service_f1a152a2a4a84d135fafb08525f0f9ce.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="sagas" tabindex="-1"><a class="header-anchor" href="#sagas"><span>Sagas</span></a></h2><p>幸运的是我们在互联网找到一篇精彩的论文，文中提出的数据一致性解决方案 Saga 恰好满足我们的业务要求。</p><div class="hint-container tip"><p class="hint-container-title">提示</p><p>Saga 是一个长活事务，可被分解成可以交错运行的子事务集合。其中每个子事务都是一个保持数据库一致性的真实事务。</p></div><p>在我们的业务场景下，一个行程规划的事务就是一个 Saga，其中包含四个子事务：机票预订、租车、酒店预订、和支付。</p><figure><img src="http://114.116.184.67:81/images/service/service_fc69ade8b2ec344c0d6f53fbec302a37.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>Chris Richardson 在他的文章 Pattern: Saga 中对 Saga 有所描述。 Caitie McCaffrey 也在她的演讲中提到如何在微软的 光晕4 游戏中如何应用 saga 解决数据一致性问题。</p><h3 id="saga-的运行原理" tabindex="-1"><a class="header-anchor" href="#saga-的运行原理"><span>Saga 的运行原理</span></a></h3><div class="hint-container tip"><p class="hint-container-title">提示</p><p>Saga 中的事务相互关联，应作为（非原子）单位执行。任何未完全执行的 Saga 是不满足要求的，如果发生，必须得到补偿。要修正未完全执行的部分，每个 saga 子交易 T1 应提供对应补偿事务 C1</p></div><p>我们根据上述规则定义以下事务及其相应的事务补偿：</p><table><thead><tr><th>服务</th><th>事务</th><th>补偿</th></tr></thead><tbody><tr><td>机票预订</td><td>预订机票</td><td>取消预订</td></tr><tr><td>租车</td><td>租车</td><td>取消预订</td></tr><tr><td>酒店预订</td><td>预订房间</td><td>取消预订</td></tr><tr><td>支付</td><td>支付</td><td>退款</td></tr></tbody></table><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>当每个 saga 子事务 T1, T2, …, Tn 都有对应的补偿定义 C1, C2, …, Cn-1, 那么 saga 系统可以保证</span></span>
<span class="line"><span></span></span>
<span class="line"><span>子事务序列 T1, T2, …, Tn 得以完成 (最佳情况)</span></span>
<span class="line"><span>或者序列 T1, T2, …, Tj, Cj, …, C2, C1, 0 &lt; j &lt; n, 得以完成</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>换句话说，通过上述定义的事务/补偿，saga 保证满足以下业务规则：</p><p>所有的预订都被执行成功，如果任何一个失败，都会被取消 如果最后一步付款失败，所有预订也将被取消</p><h3 id="saga-的恢复方式" tabindex="-1"><a class="header-anchor" href="#saga-的恢复方式"><span>Saga 的恢复方式</span></a></h3><p>原论文中描述了两种类型的 Saga 恢复方式：</p><div class="hint-container tip"><p class="hint-container-title">提示</p><p>向后恢复 补偿所有已完成的事务，如果任一子事务失败 向前恢复 重试失败的事务，假设每个子事务最终都会成功</p></div><p>显然，向前恢复没有必要提供补偿事务，如果你的业务中，子事务（最终）总会成功，或补偿事务难以定义或不可能，向前恢复更符合你的需求。</p><p>理论上补偿事务永不失败，然而，在分布式世界中，服务器可能会宕机，网络可能会失败，甚至数据中心也可能会停电。在这种情况下我们能做些什么？最后的手段是提供回退措施，比如人工干预。</p><h3 id="使用-saga-的条件" tabindex="-1"><a class="header-anchor" href="#使用-saga-的条件"><span>使用 Saga 的条件</span></a></h3><p>Saga 看起来很有希望满足我们的需求。所有长活事务都可以这样做吗？这里有一些限制：</p><ul><li>Saga 只允许两个层次的嵌套，顶级的 Saga 和简单子事务</li><li>在外层，全原子性不能得到满足。也就是说，sagas 可能会看到其他 sagas 的部分结果</li><li>每个子事务应该是独立的原子行为</li><li>在我们的业务场景下，航班预订、租车、酒店预订和付款是自然独立的行为，而且每个事务都可以用对应服务的数据库保证原子操作。</li></ul><p>我们在行程规划事务层面也不需要原子性。一个用户可以预订最后一张机票，而后由于信用卡余额不足而被取消。同时另一个用户可能开始会看到已无余票，接着由于前者预订被取消，最后一张机票被释放，而抢到最后一个座位并完成行程规划。</p><p>补偿也有需考虑的事项：</p><ul><li>补偿事务从语义角度撤消了事务 Ti 的行为，但未必能将数据库返回到执行 Ti 时的状态。（例如，如果事务触发导弹发射，则可能无法撤消此操作）</li></ul><p>但这对我们的业务来说不是问题。其实难以撤消的行为也有可能被补偿。例如，发送电邮的事务可以通过发送解释问题的另一封电邮来补偿。</p><p>现在我们有了通过 Saga 来解决数据一致性问题的方案。它允许我们成功地执行所有事务，或在任何事务失败的情况下，补偿已成功的事务。虽然 Saga 不提供 ACID 保证，但仍适用于许多数据最终一致性的场景。那我们如何设计一个 Saga 系统？</p><h3 id="saga-log" tabindex="-1"><a class="header-anchor" href="#saga-log"><span>Saga Log</span></a></h3><p>Saga 保证所有的子事务都得以完成或补偿，但 Saga 系统本身也可能会崩溃。Saga 崩溃时可能处于以下几个状态：</p><ul><li>Saga 收到事务请求，但尚未开始。因子事务对应的微服务状态未被 Saga 修改，我们什么也不需要做。</li><li>一些子事务已经完成。重启后，Saga 必须接着上次完成的事务恢复。</li><li>子事务已开始，但尚未完成。由于远程服务可能已完成事务，也可能事务失败，甚至服务请求超时，saga 只能重新发起之前未确认完成的子事务。这意味着子事务必须幂等。</li><li>子事务失败，其补偿事务尚未开始。Saga 必须在重启后执行对应补偿事务。</li><li>补偿事务已开始但尚未完成。解决方案与上一个相同。这意味着补偿事务也必须是幂等的。</li><li>所有子事务或补偿事务均已完成，与第一种情况相同。</li></ul><p>为了恢复到上述状态，我们必须追踪子事务及补偿事务的每一步。我们决定通过事件的方式达到以上要求，并将以下事件保存在名为 saga log 的持久存储中：</p><ul><li>Saga started event 保存整个 saga 请求，其中包括多个事务/补偿请求</li><li>Transaction started event 保存对应事务请求</li><li>Transaction ended event 保存对应事务请求及其回复</li><li>Transaction aborted event 保存对应事务请求和失败的原因</li><li>Transaction compensated event 保存对应补偿请求及其回复</li><li>Saga ended event 标志着 saga 事务请求的结束，不需要保存任何内容</li></ul><figure><img src="http://114.116.184.67:81/images/service/service_66ae7b320e502c13f4a21a08baa61ead.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>通过将这些事件持久化在 saga log 中，我们可以将 saga 恢复到上述任何状态。</p><p>由于 Saga 只需要做事件的持久化，而事件内容以 JSON 的形式存储，Saga log 的实现非常灵活，数据库（SQL 或 NoSQL），持久消息队列，甚至普通文件可以用作事件存储，当然有些能更快得帮 saga 恢复状态。</p><h3 id="saga-请求的数据结构" tabindex="-1"><a class="header-anchor" href="#saga-请求的数据结构"><span>Saga 请求的数据结构</span></a></h3><p>在我们的业务场景下，航班预订、租车、和酒店预订没有依赖关系，可以并行处理，但对于我们的客户来说，只在所有预订成功后一次付费更加友好。那么这四个服务的事务关系可以用下图表示：</p><figure><img src="http://114.116.184.67:81/images/service/service_918b4d0d912c6cdb8ee0690acf303950.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>将行程规划请求的数据结构实现为有向非循环图恰好合适。图的根是 saga 启动任务，叶是 saga 结束任务。</p><figure><img src="http://114.116.184.67:81/images/service/service_c62a633865fd31b25688523cb5f4093f.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="parallel-saga" tabindex="-1"><a class="header-anchor" href="#parallel-saga"><span>Parallel Saga</span></a></h3><p>如上所述，航班预订，租车和酒店预订可以并行处理。但是这样做会造成另一个问题：如果航班预订失败，而租车正在处理怎么办？我们不能一直等待租车服务回应，因为不知道需要等多久。</p><p>最好的办法是再次发送租车请求，获得回应，以便我们能够继续补偿操作。但如果租车服务永不回应，我们可能需要采取回退措施，比如手动干预。</p><p>超时的预订请求可能最后仍被租车服务收到，这时服务已经处理了相同的预订和取消请求。</p><figure><img src="http://114.116.184.67:81/images/service/service_b683af658000f43b34c7d99d6be060ca.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>因此，服务的实现必须保证补偿请求执行以后，再次收到的对应事务请求无效。 Caitie McCaffrey 在她的演讲 Distributed Sagas: A Protocol for Coordinating MicroServices 中把这个称为可交换的补偿请求 (commutative compensating request)。</p><h3 id="acid-and-saga" tabindex="-1"><a class="header-anchor" href="#acid-and-saga"><span>ACID and Saga</span></a></h3><p>ACID 是具有以下属性的一致性模型：</p><ul><li>原子性（Atomicity）</li><li>一致性（Consistency）</li><li>隔离性（Isolation）</li><li>持久性（Durability） Saga 不提供 ACID 保证，因为原子性和隔离性不能得到满足。原论文描述如下：</li></ul><div class="hint-container tip"><p class="hint-container-title">提示</p><p>full atomicity is not provided. That is, sagas may view the partial results of other sagas</p></div><p>通过 saga log，saga 可以保证一致性和持久性。</p><h3 id="saga-架构" tabindex="-1"><a class="header-anchor" href="#saga-架构"><span>Saga 架构</span></a></h3><p>最后，我们的 Saga 架构如下：</p><figure><img src="http://114.116.184.67:81/images/service/service_44bd3121a8b6d720704e2d8b363ea2ce.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>Saga Execution Component 解析请求 JSON 并构建请求图</li><li>TaskRunner 用任务队列确保请求的执行顺序</li><li>TaskConsumer 处理 Saga 任务，将事件写入 saga log，并将请求发送到远程服务 在上文中，我谈到了 ServiceComb 下的 Saga 是怎么设计的。 然而，业界还有其他数据一致性解决方案，如 <strong>两阶段提交（2PC） 和 Try-Confirm / Cancel（TCC）</strong>。那 saga 相比之下有什么特别？</li></ul><h2 id="两阶段提交-two-phase-commit-2pc" tabindex="-1"><a class="header-anchor" href="#两阶段提交-two-phase-commit-2pc"><span>两阶段提交 Two-Phase Commit (2PC)</span></a></h2><div class="hint-container tip"><p class="hint-container-title">提示</p><p>两阶段提交协议是一种分布式算法，用于协调参与分布式原子事务的所有进程，以保证他们均完成提交或中止（回滚）事务。</p></div><p>2PC 包含两个阶段：</p><ul><li>投票阶段 协调器向所有服务发起投票请求，服务回答 yes 或 no。如果有任何服务回复 no 以拒绝或超时，协调器则在下一阶段发送中止消息。</li></ul><figure><img src="http://114.116.184.67:81/images/service/service_b8624ace7c31f49016bde30abf444af0.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>决定阶段 如果所有服务都回复 yes，协调器则向服务发送 commit 消息，接着服务告知事务完成或失败。如果任何服务提交失败， 协调器将启动额外的步骤以中止该事务。</li></ul><figure><img src="http://114.116.184.67:81/images/service/service_f29111544bc473085109d3d04788be44.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>在投票阶段结束之后与决策阶段结束之前，服务处于不确定状态，因为他们不确定交易是否继续进行。当服务处于不确定状态并与协调器失去连接时，它只能选择等待协调器的恢复，或者咨询其他在确定状态下的服务来得知协调器的决定。在最坏的情况下，n 个处于不确定状态的服务向其他 n-1 个服务咨询将产生 O(n2) 个消息。</p><p>另外，2PC 是一个阻塞协议。服务在投票后需要等待协调器的决定，此时服务会阻塞并锁定资源。由于其阻塞机制和最差时间复杂度高，2PC 不能适应随着事务涉及的服务数量增加而扩展的需要。</p><h2 id="try-confirm-cancel-tcc" tabindex="-1"><a class="header-anchor" href="#try-confirm-cancel-tcc"><span>Try-Confirm/Cancel (TCC)</span></a></h2><p>TCC 也是补偿型事务模式，支持两阶段的商业模型。</p><ul><li>尝试阶段 将服务置于待处理状态。例如，收到尝试请求时，航班预订服务将为客户预留一个座位，并在数据库插入客户预订记录，将记录设为预留状态。如果任何服务失败或超时，协调器将在下一阶段发送取消请求。</li></ul><figure><img src="http://114.116.184.67:81/images/service/service_b09bbf2e8d332c163934ce165eab883e.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>确认阶段 将服务设为确认状态。确认请求将确认客户预订的座位，这时服务已可向客户收取机票费用。数据库中的客户预订记录也会被更新为确认状态。如果任何服务无法确认或超时，协调器将重试确认请求直到成功，或在重试了一定次数后采取回退措施，比如人工干预。</li></ul><figure><img src="http://114.116.184.67:81/images/service/service_1e14e4ad4804835734389a7a427ba9c3.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>与 saga 相比，TCC 的优势在于，尝试阶段将服务转为待处理状态而不是最终状态，这使得设计相应的取消操作轻而易举。</p><p>例如，电邮服务的尝试请求可将邮件标记为准备发送，并且仅在确认后发送邮件，其相应的取消请求只需将邮件标记为已废弃。但如果使用 saga，事务将发送电子邮件，及其相应的补偿事务可能需要发送另一封电子邮件作出解释。</p><p>TCC 的缺点是其两阶段协议需要设计额外的服务待处理状态，以及额外的接口来处理尝试请求。另外，TCC 处理事务请求所花费的时间可能是 saga 的两倍，因为 TCC 需要与每个服务进行两次通信，并且其确认阶段只能在收到所有服务对尝试请求的响应后开始。</p><h2 id="事件驱动的架构" tabindex="-1"><a class="header-anchor" href="#事件驱动的架构"><span>事件驱动的架构</span></a></h2><p>和 TCC 一样，在事件驱动的架构中，长活事务涉及的每个服务都需要支持额外的待处理状态。接收到事务请求的服务会在其数据库中插入一条新的记录，将该记录状态设为待处理并发送一个新的事件给事务序列中的下一个服务。</p><p>因为在插入记录后服务可能崩溃，我们无法确定是否新事件已发送，所以每个服务还需要额外的事件表来跟踪当前长活事务处于哪一步。</p><figure><img src="http://114.116.184.67:81/images/service/service_a94dc9b0b1b2195f9cff27ea3056fd5d.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>一旦长活事务中的最后一个服务完成其子事务，它将通知它在事务中的前一个服务。接收到完成事件的服务将其在数据库中的记录状态设为完成。</p><figure><img src="http://114.116.184.67:81/images/service/service_204d8d1b2939d66cfb9752219ad70920.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>如果仔细比较，事件驱动的架构就像非集中式的基于事件的 TCC 实现。如果去掉待处理状态而直接把服务记录设为最终状态，这个架构就像非集中式的基于事件的 saga 实现。去中心化能达到服务自治，但也造成了服务之间更紧密的的耦合。假设新的业务需求在服务 B 和 C 之间的增加了新的流程 D。在事件驱动架构下，服务 B 和 C 必须改动代码以适应新的流程 D。</p><figure><img src="http://114.116.184.67:81/images/service/service_3f46ba9b45f867c33993cdb81871bfc9.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>Saga 则正好相反，所有这些耦合都在 saga 系统中，当在长活事务中添加新流程时，现有服务不需要任何改动。</p><h2 id="集中式与非集中式实现" tabindex="-1"><a class="header-anchor" href="#集中式与非集中式实现"><span>集中式与非集中式实现</span></a></h2><p>这个 Saga 系列的文章讨论的都是集中式的 saga 设计。但 saga 也可用非集中式的方案来实现。那么非集中式的版本有什么不同？</p><p>非集中式 saga 没有专职的协调器。启动下一个服务调用的服务就是当前的协调器。例如：</p><ul><li>服务 A 收到要求服务 A，B 和 C 之间的数据一致性的事务请求。</li><li>A 完成其子事务，并将请求传递给事务中的下一个服务，服务 B.</li><li>B 完成其子事务，并将请求传递给 C，依此类推。</li><li>如果 C 处理请求失败，B 有责任启动补偿事务，并要求 A 回滚。</li></ul><figure><img src="http://114.116.184.67:81/images/service/service_1a7a9de881f2665697337a03fb1a5c6f.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>与集中式相比，非集中式的实现具有服务自治的优势。但每个服务都需要包含数据一致性协议，并提供其所需的额外持久化设施。</p><p>我们更倾向于自治的业务服务，但服务还关联很多应用的复杂性，如数据一致性，服务监控和消息传递，将这些棘手问题集中处理，能将业务服务从应用的复杂性中释放，专注于处理复杂的业务，因此我们采用了集中式的 saga 设计。</p><p>另外，随着长活事务中涉及的服务数量增长，服务之间的关系变得越来越难理解。</p><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h2><p>本文将 saga 与其他数据一致性解决方案进行了比较。Saga 比两阶段提交更易扩展。在事务可补偿的情况下，相比 TCC，saga 对业务逻辑几乎没有改动的需要，而且性能更高。集中式的 saga 设计解耦了服务与数据一致性逻辑及其持久化设施，并使排查事务中的问题更容易。</p></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/cangbaoy/docs.github.io/edit/main/src/exambook/Java-Service8.md" aria-label="编辑此页" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->编辑此页<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">上次编辑于: </span><!----></div><div class="contributors"><span class="vp-meta-label">贡献者: </span><!--[--><!--[--><span class="vp-meta-info" title="email: yph0228@163.com">him</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/exambook/Java-Service14.html" aria-label="微服务的安全"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><!---->微服务的安全</div></a><a class="route-link auto-link next" href="/exambook/Java-Performance1.html" aria-label="性能指标有哪些"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">性能指标有哪些<!----></div></a></nav><div id="vp-comment" class="giscus-wrapper input-top" style="display:block;"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" preserveAspectRatio="xMidYMid" viewBox="0 0 100 100"><circle cx="28" cy="75" r="11" fill="currentColor"><animate attributeName="fill-opacity" begin="0s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></circle><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 47a28 28 0 0 1 28 28"><animate attributeName="stroke-opacity" begin="0.1s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 25a50 50 0 0 1 50 50"><animate attributeName="stroke-opacity" begin="0.2s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path></svg></div><!----><!--]--></main><!--]--><!----></div><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script src="/assets/js/runtime~app.e84162b8.js" defer></script><script src="/assets/js/4893.6b2ef6da.js" defer></script><script src="/assets/js/app.bb7342ad.js" defer></script>
  </body>
</html>
